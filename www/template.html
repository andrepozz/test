<!DOCTYPE html>
<html>
<head>
	<link rel="stylesheet" href="css/themes/shopincomo.min.css" />
	<link rel="stylesheet" href="css/themes/jquery.mobile.icons.min.css" />
	<link rel="stylesheet" href="css/jquery.mobile.structure-1.4.2.min.css" />
	
	<link rel="stylesheet" href="css/template.css" />
	
	<script src="js/jquery-1.11.0.min.js"></script>
	<script src="js/jquery.mobile-1.4.2.min.js"></script>
	
	<!-- cordova facebook plugin -->
	<script src="cdv-plugin-fb-connect.js"></script>
	<!-- facebook js sdk -->
	<script src="facebook-js-sdk.js"></script>
	
	<script src="js/highcharts.js"></script>
	<link rel="stylesheet" href="css/leaflet.css" />
	<link rel="stylesheet" href="css/leaflet.usermarker.css" />
	<link rel="stylesheet" href="css/vetrina.css" />
	<script src="js/leaflet.js"></script>
	<script src="js/leaflet.usermarker.js"></script>
	<script src="js/function_checkConnection.js"></script>
	<script type="text/javascript" src="cordova.js"></script>
	<title>QRcode</title>
</head>
<body>
<!-- Start of page: #QRscanner -->
<div data-role="page" id="QRscanner">

	<div data-role="header">
		<a href="opzioni.html" rel="external" data-icon="gear" data-iconpos="notext" class="ui-btn-left" data-transition="slide">Options</a>
		<h1></h1>
		<a href="opzioni.html" rel="external" data-icon="gear" data-iconpos="notext" class="ui-btn-right" data-transition="slide">Options</a>
	</div><!-- /header -->

	<div role="main" class="ui-content" >
		
	<script type="text/javascript" charset="utf-8">
	
	$( document ).on( "pagebeforeshow", "#QRscanner", function() {
	
	document.addEventListener("backbutton", onBackKeyDown, false);
		
	function onBackKeyDown(e) {
	e.preventDefault();
	}
	
	$("ul#lista_esercizi").html("");
	
	//CARICA JSON CATEGORIE
	var path = window.localStorage.getItem("pathSD");
	var jsonPath = "js/Abbigliamento.js";
		
	var jsonSottocategorie;
	
	$.ajax({
	url: jsonPath,
	dataType: 'json',
	async: false,
		success: function(data) {
		jsonSottocategorie = data;
		}
	});
	
	
		var eserciziVicini = [];
		userLatitudeVicini = 45.80103;
		userLongitudeVicini = 9.09192;
		//NEAREST NODE
		
		for(var i=0; i<jsonSottocategorie.length; i++ ){
		var distance;	
		distance = getDistanceFromLatLonInKm(userLatitudeVicini, userLongitudeVicini, jsonSottocategorie[i].latitudeEsercizio, jsonSottocategorie[i].longitudeEsercizio);
		jsonSottocategorie[i].distance = ""+distance+"";
		}
		console.log(jsonSottocategorie);

	});
	// /PAGESHOW
	
	function getDistanceFromLatLonInKm(lat1,lon1,lat2,lon2) {
  
		var R = 6371; // Radius of the earth in km
  
		var dLat = deg2rad(lat2-lat1);  // deg2rad below
		var dLon = deg2rad(lon2-lon1); 
  
		var a = 
		Math.sin(dLat/2) * Math.sin(dLat/2) +
		Math.cos(deg2rad(lat1)) * Math.cos(deg2rad(lat2)) * 
		Math.sin(dLon/2) * Math.sin(dLon/2)
		; 
  
		var c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a)); 
		var d = R * c * 1000; // Distance in km
		return Math.round(d);
	}

	function deg2rad(deg) {
	
	return deg * (Math.PI/180)
	}
	
	</script>
	

	</div><!-- /content -->

	<div data-role="footer" data-position="fixed">
	<h1>Scanner</h1>
	</div><!-- /footer -->
</div><!-- /page QRscanner -->




</body>
</html>

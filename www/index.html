<!--
#index
	DONE:
	- fixed header
	- fixed footer
	- back button carat-l
	
#lingue
	DONE:
	- fixed header
	- fixed footer
	
#setupCategorie:
	DONE:
	- fixed header
	- fixed footer
	
#setupNegozi:
	DONE:
	- fixed header
	- fixed footer
	
#facebook:
	DONE:
	- fixed header
	- fixed footer
	
#foursquare:
	DONE:
	- fixed header
	- fixed footer
	
#twitter:
	DONE:
	- fixed header
	- fixed footer

#vetrinaMappa
	DONE:
	- fixed header
	- fixed footer
	- back button carat-l

#vetrinaOrari
	DONE:
	- fixed header
	- fixed footer
	- back button carat-l

#vetrinaContatti
	DONE:
	- fixed header
	- fixed footer
	- back button carat-l
	- href:tel Telefono
	- href:mailto Email
	- link sito web
	TO DO:
	- icone

#vetrinaStatistiche
	DONE:
	- fixed header
	- fixed footer
	- back button carat-l

#credits:
	DONE:
	- fixed header
	- fixed footer
-->

<!DOCTYPE html>
<html>
<head>
	<title>Page Title</title>

	<link rel="stylesheet" href="css/themes/shopincomo.min.css" />
	<link rel="stylesheet" href="css/themes/jquery.mobile.icons.min.css" />
	<link rel="stylesheet" href="css/jquery.mobile.structure-1.4.2.min.css" />
	
	<link rel="stylesheet" href="css/template.css" />
	
	<script src="js/jquery-1.11.0.min.js"></script>
	<script src="js/jquery.mobile-1.4.2.min.js"></script>
	
	<!-- cordova facebook plugin -->
	<script src="cdv-plugin-fb-connect.js"></script>
	<!-- facebook js sdk -->
	<script src="facebook-js-sdk.js"></script>
	
	<script src="js/highcharts.js"></script>
	<link rel="stylesheet" href="css/leaflet.css" />
	<link rel="stylesheet" href="css/leaflet.usermarker.css" />
	<link rel="stylesheet" href="css/vetrina.css" />
	<script src="js/leaflet.js"></script>
	<script src="js/leaflet.usermarker.js"></script>
	<script src="js/function_checkConnection.js"></script>
	<script type="text/javascript" src="cordova.js"></script>
</head>
<body>

<!-- PAGE #index -->
<div data-role="page" id="index">

	<!-- /HEADER -->
	<div data-role="header" data-position="fixed" data-tap-toggle="false">
	<h1></h1>
	</div>
	<!-- /HEADER -->
	
	<!-- CONTENT -->
	<div role="main" class="ui-content" >
	
	<script>   
	$( "#index" ).on( "pageshow", function() {	
	
	document.addEventListener("backbutton", onBackKeyDown, false);
		
		function onBackKeyDown(e) {
		e.preventDefault();
		}
	
	$(".headerUpdateDisponibili").html(""+window.localStorage.getItem("aggiornamentiDisponibili")+"");
	$(".descrizioneUpdateDisponibili").html(""+window.localStorage.getItem("aggiornamentiPopupDescrizione")+"");
	$(".buttonUpdateDisponibili").html(""+window.localStorage.getItem("aggiorna")+"");
	$(".closePopupUpdateDisponibili").html(""+window.localStorage.getItem("chiudi")+"");
		
	var lingua = window.localStorage.getItem("lingua");

	if (lingua == null) {
	
			$.mobile.changePage( "#lingue", { allowSamePageTransition:true, transition: "slide" } );
	}
	else
	{
	
	//CHECK GEOLOCATION
	
	var watchID = null;
	var options = { maximumAge: 1500, timeout: 30000, enableHighAccuracy: true };
	
	watchID = navigator.geolocation.watchPosition(onSuccess, onError, options);
	
	$.mobile.loading( "show", {
            text: ""+window.localStorage.getItem("localizzando")+"",
            textVisible: true,
            theme: "a",
            textonly: false
	});
	
	function onSuccess(position) {
	
	var userLatitude = position.coords.latitude;
    var userLongitude = position.coords.longitude;
	var userAccuracy = position.coords.accuracy;
	
	window.sessionStorage.setItem("userLatitude", userLatitude);
	window.sessionStorage.setItem("userLongitude", userLongitude);
	window.sessionStorage.setItem("userAccuracy", userAccuracy);
	checkUpdates();
	$.mobile.loading( "hide" );
    }
	
	function onError(error) {
            console.log('code: ' + error.code + '\n' + 'message: ' + error.message + '\n');
    }




	
	// CHECK UPDATES
	
	//setTimeout(function () { checkUpdates(); }, 5000);
	
	// SET MENU
	var codLinguaMenu = window.localStorage.getItem("codLingua");
	
	if(codLinguaMenu == "it" || codLinguaMenu == null){
	estensioneImmagine = "it";
	}
	else{
	estensioneImmagine = "en";
	}
	
	$("div#rigaBorsa_1").html("");
	$("div#rigaBorsa_2").html("");
	$("div#rigaBorsa_1").append($("<div class='blocco_sx'><a href='eserciziVicini.html' rel='external' data-transition='slide'><img src='img/ricercaDistanza_"+estensioneImmagine+".png'></a></div><div class='blocco_dx'><a href='categorie.html' rel='external' data-transition='slide'><img src='img/ricercaCategoria_"+estensioneImmagine+".png'></a></div>"));
	$("div#rigaBorsa_2").append($("<div class='blocco_sx'><a href='nomeEsercizi.html' rel='external' data-transition='slide'><img src='img/ricercaNegozio_"+estensioneImmagine+".png'></a></div><div class='blocco_dx'><a href='brandEsercizi.html' rel='external' data-transition='slide'><img src='img/ricercaBrand_"+estensioneImmagine+".png'></a></div>"));
	
	}
	
	});
	
	function checkUpdates(){
	var	connectionStatus = navigator.onLine ? 'online' : 'offline';
	if (connectionStatus == "online" && window.sessionStorage.getItem("doneCheckUpdates") != "si")
	{
		
		$.mobile.loading( "show", {
            text: "Check Updates",
            textVisible: true,
            theme: "a",
            textonly: false
		});

		window.requestFileSystem(LocalFileSystem.PERSISTENT, 0, function(fileSystem) {
			
			fileSystem.root.getDirectory("ccn/esercizi", {create: true, exclusive: false}, function(dirEntry) {
			
				// Get a directory reader
				var directoryReader = dirEntry.createReader();

				// Get a list of all the entries in the directory
				directoryReader.readEntries(success,fail);
				
				function success(entries) {
					
					var path = window.localStorage.getItem("pathSD");
					var jsonPath = path + "/nomeEsercizi.js";

					var fileEserciziMancanti = [];		
					$.getJSON(jsonPath, function( listaEsercizi ) {
						var idEsercizi = [];
						$.each(listaEsercizi, function(index, info) {
						
							idEsercizi.push({
							idEsercizio: info.idEsercizio
							});

						
						});
					
					for (var i=0;i<idEsercizi.length;i++) {
					rv = false;
					for (var j=0;j<entries.length;j++) {
					rv = rv ||  parseInt(idEsercizi[i].idEsercizio) == parseInt(entries[j].name.substring(0, entries[j].name.length - 3));
					}
					if(!rv)
					{
					fileEserciziMancanti.push(idEsercizi[i].idEsercizio);
					}
					}
					eserciziUpdate(fileEserciziMancanti);
					window.sessionStorage.setItem("fileEserciziMancanti", JSON.stringify(fileEserciziMancanti));
					});
					
				}

				function fail(error) {
					console.log("Failed to list directory contents: " + error.code);
				}
			
			}); // fileSystem.root.getDirectory
			
		}); // end of window.requestFileSystem
		
		
		function eserciziUpdate(fileEserciziMancanti){
				
		window.requestFileSystem(LocalFileSystem.PERSISTENT, 0, function(fileSystem) {
			
			fileSystem.root.getDirectory("ccn", {create: true, exclusive: false}, function(dirEntry) {
			
				dirEntry.getFile("categorie.js", {create: true, exclusive: false}, function(fileEntry) {
										
					fileEntry.getMetadata(function(metadata) {
					var dataDownload = Date.parse(metadata.modificationTime) / 1000;
					
					localStorage.setItem("dataDownload", dataDownload );
					
					var urlJSON = "http://www.wificomo.com/ccn20/JSONidEserciziUpdate.php?language="+localStorage.getItem("codLingua")+"&dataDownload="+dataDownload;

						$.getJSON(urlJSON, function( data ) {
							if (data.length == 0 && fileEserciziMancanti.length == 0) {
								//alert("NO aggiornamenti disponibili");
								//$("p.countUpdates").html(""+window.localStorage.getItem("statusDatabase")+"");
								$.mobile.loading( "hide" );
							}
							else {
								$( "#updateDisponibili" ).popup("open");
								$.mobile.loading( "hide" );
							}
						});
					});
					 
				}); // end of dirEntry.getFile
			
			}); // fileSystem.root.getDirectory
			
		}); // end of window.requestFileSystem
		
		}
	}
	var doneCheckUpdates = "si"
	window.sessionStorage.setItem("doneCheckUpdates", doneCheckUpdates);
	
	}
	//FINE CHECK UPDATES
	
	
	//ON "click"
	$(document).on("click", 'a.qrCode', function(){
	
	var scanner = cordova.require("cordova/plugin/BarcodeScanner");
	
	scanner.scan( function (result) {
		
		var url = result.text;
		var match = url.match(/it\/content\/(\d+)/);
		if (match) {
			idEsercizio = match[1];
			$.mobile.changePage( "#vetrinaMappa", { allowSamePageTransition:true} );
			
		} // END MATCH
		// FINE SUCCESS SCANNER
	},function (error) { 
        console.log("Scanning failed: ", error); 
	}); //END SCANNER
	
	}); //ON "click"
	
	$(document).on("click", 'a.closePopupUpdateDisponibili', function(){
		
		$( "#updateDisponibili" ).popup("close");
		
	});
		
	</script>

	<div id="manicoBorsa">
	<img src="img/manico.png">
	</div>
	<div id="rigaBorsa_1">
	</div>
	<div id="rigaBorsa_2">
	</div>
	
	
	
	<div data-role="popup" id="updateDisponibili" data-dismissible="false" data-history="false">
	<p class="headerUpdateDisponibili"></p>
    <p class="descrizioneUpdateDisponibili"></p>
	<a href="opzioni.html" rel="external" class="ui-btn buttonUpdateDisponibili">Update</a>
	<a href="#" class="ui-btn closePopupUpdateDisponibili"></a>
	</div>
	
	</div>
	<!-- /CONTENT -->

	<!-- FOOTER -->
	<div data-role="footer" data-position="fixed" data-tap-toggle="false">
		<div data-role="navbar">
			<ul>
			<li><a href="#" class="qrCode"><img src="img/qrcode.png"></a></li>
			<li><a href="opzioni.html" rel="external" data-transition="slide"><img src="img/opzioni.png"></a></li>
			<li><a href="#credits" data-transition="flip"><img src="img/info.png"></a></li>
			</ul>
		</div><!-- /navbar -->
	</div>
	<!-- /FOOTER -->
	
</div><!-- /PAGE #index -->

<!-- PAGE #lingue -->
	<div data-role="page" id="lingue">

	<!-- /HEADER -->
	<div data-role="header" data-position="fixed" data-tap-toggle="false">
		<h1></h1>
	</div>
	<!-- /HEADER -->
	
	<!-- CONTENT -->
	<div role="main" class="ui-content" >
	
	<script>
  
	$( "#lingue" ).on( "pagebeforeshow", function() {	
	
	document.addEventListener("backbutton", onBackKeyDown, false);
		
		function onBackKeyDown(e) {
		e.preventDefault();
		}
	
	//LISTA LINGUE
	$("ul#listaLingue").html("");
		
		$.getJSON("js/lingue.js", function( data ) {
		
			$.each(data, function(index, info) {
			$("ul#listaLingue").append($("<li></li>",{"html":"<a href='#' class='lingua' id='" + info.idLingua + "' codiceLingua='"+info.codiceLingua+"' nomeLingua='"+index+"' data-transition='slide' ><img src='img/lingue/"+info.codiceLingua+".png' alt='Facebook' class='ui-li-icon ui-corner-none'>" + info.nomeLingua + "</a>" }));
			});
	
			$("ul#listaLingue").listview("refresh");
		});
	
	}); //ON "pagebeforeshow"
	
	//ON "click"
	$(document).on("click", 'a.lingua', function(){
	
	var	connectionStatus = navigator.onLine ? 'online' : 'offline';
	
	if (connectionStatus == "online")
	{
	idLingua = $(this).attr('id');
	lingua = $(this).attr('nomeLingua');
	codLingua = $(this).attr('codiceLingua');
	
	window.localStorage.setItem("lingua", lingua);
	window.localStorage.setItem("idLingua", idLingua);
	window.localStorage.setItem("codLingua", codLingua);
	
	// TRADUZIONI------------------------------------------------------------------------------
	$.getJSON("js/lingue.js", function( lingue ) {
			
	
	window.localStorage.setItem("nome", lingue[lingua].nome);
	window.localStorage.setItem("nomiEsercizi", lingue[lingua].nomiEsercizi);
	window.localStorage.setItem("position", lingue[lingua].position);
	window.localStorage.setItem("categorie", lingue[lingua].categorie);
	window.localStorage.setItem("sottoCategorie", lingue[lingua].sottoCategorie);
	window.localStorage.setItem("brandEsercizi", lingue[lingua].brandEsercizi);
	window.localStorage.setItem("downloadFunzionalita", lingue[lingua].downloadFunzionalita);
	window.localStorage.setItem("downloadEsercizi", lingue[lingua].downloadEsercizi);
	window.localStorage.setItem("attendere", lingue[lingua].attendere);
	window.localStorage.setItem("continua", lingue[lingua].continua);
	window.localStorage.setItem("localizzando", lingue[lingua].localizzando);
	window.localStorage.setItem("salta", lingue[lingua].salta);
	window.localStorage.setItem("chiudi", lingue[lingua].chiudi);
	window.localStorage.setItem("vota", lingue[lingua].vota);
	window.localStorage.setItem("voti", lingue[lingua].voti);
	window.localStorage.setItem("essereOnline", lingue[lingua].essereOnline);
	window.localStorage.setItem("onlineSetup", lingue[lingua].onlineSetup);
	window.localStorage.setItem("distanza", lingue[lingua].distanza);
	window.localStorage.setItem("votoTrendy", lingue[lingua].votoTrendy);
	window.localStorage.setItem("votoPopular", lingue[lingua].votoPopular);
	window.localStorage.setItem("giorni", lingue[lingua].giorni);
	window.localStorage.setItem("noStatistiche", lingue[lingua].noStatistiche);
	window.localStorage.setItem("contatti", lingue[lingua].contatti);
	window.localStorage.setItem("telefono", lingue[lingua].telefono);
	window.localStorage.setItem("orariApertura", lingue[lingua].orariApertura);
	window.localStorage.setItem("noOrari", lingue[lingua].noOrari);
	window.localStorage.setItem("lunedi", lingue[lingua].lunedi);
	window.localStorage.setItem("martedi", lingue[lingua].martedi);
	window.localStorage.setItem("mercoledi", lingue[lingua].mercoledi);
	window.localStorage.setItem("giovedi", lingue[lingua].giovedi);
	window.localStorage.setItem("venerdi", lingue[lingua].venerdi);
	window.localStorage.setItem("sabato", lingue[lingua].sabato);
	window.localStorage.setItem("domenica", lingue[lingua].domenica);
	window.localStorage.setItem("votaNegozio", lingue[lingua].votaNegozio);
	window.localStorage.setItem("portamiQui", lingue[lingua].portamiQui);
	window.localStorage.setItem("mostra", lingue[lingua].mostra);
	window.localStorage.setItem("nascondi", lingue[lingua].nascondi);
	window.localStorage.setItem("postPubblicato", lingue[lingua].postPubblicato);
	window.localStorage.setItem("tweetPubblicato", lingue[lingua].tweetPubblicato);
	window.localStorage.setItem("checkinPubblicato", lingue[lingua].checkinPubblicato);
	window.localStorage.setItem("noCheckin", lingue[lingua].noCheckin);
	window.localStorage.setItem("troppoLontano", lingue[lingua].troppoLontano);
	window.localStorage.setItem("collegaSetupTitolo", lingue[lingua].collegaSetupTitolo);
	window.localStorage.setItem("collegaSetupDescrizione", lingue[lingua].collegaSetupDescrizione);
	window.localStorage.setItem("collegaSocial", lingue[lingua].collegaSocial);
	window.localStorage.setItem("noCollegaSocial", lingue[lingua].noCollegaSocial);
	window.localStorage.setItem("accountCollegato", lingue[lingua].accountCollegato);
	window.localStorage.setItem("prossimoPasso", lingue[lingua].prossimoPasso);
	window.localStorage.setItem("placeholderNome", lingue[lingua].placeholderNome);
	window.localStorage.setItem("placeholderBrand", lingue[lingua].placeholderBrand);
	window.localStorage.setItem("linguaApp", lingue[lingua].linguaApp);
	window.localStorage.setItem("cambiaLinguaApp", lingue[lingua].cambiaLinguaApp);
	window.localStorage.setItem("aggiorna", lingue[lingua].aggiorna);
	window.localStorage.setItem("aggiornaDatabaseApp", lingue[lingua].aggiornaDatabaseApp);
	window.localStorage.setItem("statusDatabase", lingue[lingua].statusDatabase);
	window.localStorage.setItem("aggiornamentoCompletato", lingue[lingua].aggiornamentoCompletato);
	window.localStorage.setItem("aggiornamentiDisponibili", lingue[lingua].aggiornamentiDisponibili);
	window.localStorage.setItem("aggiornamentiPopupDescrizione", lingue[lingua].aggiornamentiPopupDescrizione);
		
	});
	
	// /TRADUZIONI----------------------------------------------------------------------------
	$.mobile.changePage( "#setupCategorie", { allowSamePageTransition:true, transition: "slide" } );
	}
	else
	{
	$( "#connectionOfflineLingua" ).popup("open");
	}
	
	
	}); //ON "click"
	
	$(document).on("click", 'a.closePopup', function(){
		
		$( "#connectionOfflineLingua" ).popup("close");
		
	});
	
	</script>

	<ul data-role="listview" id="listaLingue" data-inset="true">
	</ul>
	
	<div data-role="popup" id="connectionOfflineLingua" data-dismissible="false" data-history="false">
	<p class="headerOffline">OFFLINE</p>
    <p class="descrizioneOffline">Il setup dell'Applicazione richiede una connessione WiFi o 3g</p>
	<p class="descrizioneOffline">WiFi or 3g is necessary to setup the Application</p>
	<a href="#" class="ui-btn closePopup">Riprova/Try Agay</a>
	</div>
	
	</div>
	<!-- CONTENT -->

	<!-- FOOTER -->
	<div data-role="footer" data-position="fixed" data-tap-toggle="false">
		<h4></h4>
	</div>
	<!-- /FOOTER -->

	</div>
<!-- /PAGE #lingue -->

<!-- PAGE #setupCategorie -->
	<div data-role="page" id="setupCategorie">

	<!-- /HEADER -->
	<div data-role="header" data-position="fixed" data-tap-toggle="false">
		<h1></h1>
	</div>
	<!-- /HEADER -->
	
	<!-- CONTENT -->
	<div role="main" class="ui-content" >
	
	<script>   
	$( "#setupCategorie" ).on( "pageshow", function() {	
	
	document.addEventListener("backbutton", onBackKeyDown, false);
		
	function onBackKeyDown(e) {
	e.preventDefault();
	}
	
	$("h3.titoloDownloadFunzionalita").html(window.localStorage.getItem("downloadFunzionalita"));
	
	$("ul.downloadList").append($('<li class="'+window.localStorage.getItem("nomiEsercizi")+'"><img class="iconaTipologia" src="img/downloadnome.png"> DOWNLOAD '+window.localStorage.getItem("nomiEsercizi")+'... <img src="img/download.gif"></li>'));
	$("ul.downloadList").append($('<li class="brand"><img class="iconaTipologia" src="img/downloadbrand.png"> DOWNLOAD brand... <img src="img/download.gif"></li>'));
	$("ul.downloadList").append($('<li class="'+window.localStorage.getItem("brandEsercizi")+'"><img class="iconaTipologia" src="img/downloadbrandEsercizi.png"> DOWNLOAD '+window.localStorage.getItem("brandEsercizi")+'... <img src="img/download.gif"></li>'));
	$("ul.downloadList").append($('<li class="'+window.localStorage.getItem("position")+'"><img class="iconaTipologia" src="img/downloadposition.png"> DOWNLOAD position... <img src="img/download.gif"></li>'));
	$("ul.downloadList").append($('<li class="categorie"><img class="iconaTipologia" src="img/downloadCategorie.png"> DOWNLOAD '+window.localStorage.getItem("categorie")+'...<img src="img/download.gif"></li>'));
	$("ul.downloadList").append($('<li class="sottocategorie"><img class="iconaTipologia" src="img/downloadSottocategorie.png"> DOWNLOAD '+window.localStorage.getItem("sottoCategorie")+'...<img src="img/download.gif"></li>'));
	
	var urlCategorie = encodeURI("http://www.wificomo.com/ccn20/JSONcategorie.php?language="+codLingua+"");	
	var fileNameCategorie = "categorie.js";
		
		var fileTransfer = new FileTransfer();
			
		window.requestFileSystem(LocalFileSystem.PERSISTENT, 0, function(fileSystem) {
			
			fileSystem.root.getDirectory("ccn", {create: true, exclusive: false}, function(dirEntry) {
			
				dirEntry.getFile(fileNameCategorie, {create: true, exclusive: false}, function(fileEntry) {
										
					var localPath = fileEntry.fullPath;

					if (device.platform === "Android" && localPath.indexOf("file://") === 0) {
						localPath = localPath.substring(7);
					}
					
					fileTransfer.download(
						urlCategorie,
						localPath,
						
						function(entry) {
						
								//MEMORIZZA PATH
								var directory = dirEntry.fullPath;
								var indexPath = directory.lastIndexOf("/");
								var pathSD = directory.substr(7, indexPath-7);
								pathSD = pathSD+"/ccn";
								window.localStorage.setItem('pathSD', pathSD);
								
								$("li.categorie").html("<img class='iconaTipologia' src='img/downloadCategorie.png'> DOWNLOAD "+window.localStorage.getItem("categorie")+" <img src='img/downloadok.png'>");
								$("li.categorie").css("color","white");
								$("li.categorie").css("background","#00CC00");
								
								getSottocategorie();
						},
						function(error) {
							console.log("download error source " + error.source);
							console.log("download error target " + error.target);
							console.log("download error code " + error.code);
						},
						false,
						{
							headers: {
								"Authorization": "Basic dGVzdHVzZXJuYW1lOnRlc3RwYXNzd29yZA=="
							}
						}
				
					); // end of fileTransfer.download
				}); // end of dirEntry.getFile
			
			}); // fileSystem.root.getDirectory
			
		}); // end of window.requestFileSystem
		
	//FUNCTION getSottocategorie()
	function getSottocategorie() {
	
		var codLingua = window.localStorage.getItem('codLingua');
		var path = window.localStorage.getItem('pathSD');
		var pathCategorie = path+"/categorie.js";
		
		$.getJSON(pathCategorie, function( data ) {
		
			var numElementi = data.length;
			
			window.sessionStorage.setItem("numElementi", numElementi);
		
			$.each(data, function(index, info) {
			
			var urlSottocategorie = encodeURI("http://www.wificomo.com/ccn20/JSONsottocategorieNegozi.php?idCategoria="+info.idCategoria+"&language="+codLingua+"");	
			var fileNameSottocategorie = info.jsonName+".js";
			var directory = "ccn";
			
			downloadSottocategorie(directory, fileNameSottocategorie, urlSottocategorie);
			});
		});
		
	} //FUNCTION getSottocategorie()
	
	//JSON RICERCA PER NOME
	
	var urlnomeEsercizi = encodeURI("http://www.wificomo.com/ccn20/JSONnomeEsercizi.php");	
	var fileNamenomeEsercizi = "nomeEsercizi.js";
	var directory = "ccn";
	var pClass = ""+window.localStorage.getItem("nomiEsercizi")+"";
	var imgName = "nome";
	
	downloadJSON(directory, fileNamenomeEsercizi, urlnomeEsercizi, pClass, imgName);
	
	//JSON BRAND ESERCIZI
	
	var urlbrandEsercizi = encodeURI("http://www.wificomo.com/ccn20/JSONbrandEsercizi.php");
	var fileNamebrandEsercizi = "brandEsercizi.js";
	var directory = "ccn";
	var pClass = ""+window.localStorage.getItem("brandEsercizi")+"";
	var imgName = "brandEsercizi";
	
	downloadJSON(directory, fileNamebrandEsercizi, urlbrandEsercizi, pClass, imgName);
	
	//JSON RICERCA PER BRAND
	
	var urlbrand = encodeURI("http://www.wificomo.com/ccn20/JSONbrand.php");
	var fileNamebrand = "brand.js";
	var directory = "ccn";
	var pClass = "brand";
	var imgName = "brand";
	
	downloadJSON(directory, fileNamebrand, urlbrand, pClass, imgName);
	
	//JSON POSITION
	
	var urlposition = encodeURI("http://www.wificomo.com/ccn20/JSONposition.php");
	var filePosition = "position.js";
	var directory = "ccn";
	var pClass = ""+window.localStorage.getItem("position")+"";
	var imgName = "position";
	
	downloadJSON(directory, filePosition, urlposition, pClass, imgName);
	
	/*
	//JSON DISTANCE
	
	var urldistance = encodeURI("http://www.wificomo.com/ccn20/JSONdistance.php");
	var fileDistance = "distance.js";
	var directory = "ccn";
	var pClass = "distance";
	
	downloadJSON(directory, fileDistance, urldistance, pClass);
	
	*/
	
	}); // ON "pageshow"
	
	//DOWNLOAD JSON FUNCTION
	function downloadJSON(directory, fileName, fileURL, pClass, imgName) {

		var fileTransfer = new FileTransfer();
		
		window.requestFileSystem(LocalFileSystem.PERSISTENT, 0, function(fileSystem) {
			
			fileSystem.root.getDirectory(directory, {create: true, exclusive: false}, function(dirEntry) {
			
				dirEntry.getFile(fileName, {create: true, exclusive: false}, function(fileEntry) {
										
					var localPath = fileEntry.fullPath;

					if (device.platform === "Android" && localPath.indexOf("file://") === 0) {
							localPath = localPath.substring(7);
					}
					
					fileTransfer.download(
						fileURL,
						localPath,
						function(entry) {
						
						$("li."+pClass+"").html("<img class='iconaTipologia' src='img/download"+imgName+".png'> DOWNLOAD "+pClass+" <img src='img/downloadok.png'>");
						$("li."+pClass+"").css("color","white");
						$("li."+pClass+"").css("background","#00CC00");
						
							/*
							conteggioEsercizi = parseInt(conteggioEsercizi)+1;
															
								if(conteggioEsercizi == totaleEsercizi) {
								alert("scaricati "+conteggioEsercizi+" esercizi");
								sessionStorage.setItem("downloadEsercizi", "ok");
								}
							*/
						},
						function(error) {
							console.log("download error source " + error.source);
							console.log("download error target " + error.target);
						},
						false,
						{
							headers: {
								"Authorization": "Basic dGVzdHVzZXJuYW1lOnRlc3RwYXNzd29yZA=="
							}
						}
				
					); // end of fileTransfer.download
				}); // end of dirEntry.getFile
			
			}); // fileSystem.root.getDirectory
			
		}); // end of window.requestFileSystem
		
	} //FUNCTION downloadJSON
	
	//DOWNLOAD JSONmulti FUNCTION
	function downloadSottocategorie(directory, fileName, fileURL) {
		
		var fileTransfer = new FileTransfer();
		
		window.requestFileSystem(LocalFileSystem.PERSISTENT, 0, function(fileSystem) {
			
			fileSystem.root.getDirectory(directory, {create: true, exclusive: false}, function(dirEntry) {
			
				dirEntry.getFile(fileName, {create: true, exclusive: false}, function(fileEntry) {
										
					var localPath = fileEntry.fullPath;

					if (device.platform === "Android" && localPath.indexOf("file://") === 0) {
							localPath = localPath.substring(7);
					}
					
					fileTransfer.download(
						fileURL,
						localPath,
						function(entry) {
						
						var numElementi = window.sessionStorage.getItem("numElementi");
						numElementi = parseInt(numElementi)-1;							
								if(numElementi == 0) {
								
									$("li.sottocategorie").html("<img class='iconaTipologia' src='img/downloadSottocategorie.png'> DOWNLOAD "+window.localStorage.getItem("sottoCategorie")+" <img src='img/downloadok.png'>");
									$("li.sottocategorie").css("color","white");
									$("li.sottocategorie").css("background","#00CC00");
									$("p.downloadComplete").html("<a href='#setupNegozi' class='ui-btn' data-transition='slide'>"+window.localStorage.getItem("continua")+"</a>");		
								}
								else {
								sessionStorage.setItem("numElementi", numElementi);
								}
						},
						function(error) {
							
							var numElementiError = window.sessionStorage.getItem("numElementi");
							numElementiError = parseInt(numElementiError)-1;							
							
							if(numElementiError == 0) {
								
									$("li.sottocategorie").html("<img class='iconaTipologia' src='img/downloadSottocategorie.png'> DOWNLOAD "+window.localStorage.getItem("sottoCategorie")+" <img src='img/downloadok.png'>");
									$("li.sottocategorie").css("color","white");
									$("li.sottocategorie").css("background","#00CC00");
									$("p.downloadComplete").html("<a href='#setupNegozi' class='ui-btn' data-transition='slide'>"+window.localStorage.getItem("continua")+"</a>");			
							}
							else {
							sessionStorage.setItem("numElementi", numElementiError);
							}
						},
						false,
						{
							headers: {
								"Authorization": "Basic dGVzdHVzZXJuYW1lOnRlc3RwYXNzd29yZA=="
							}
						}
				
					); // end of fileTransfer.download
				}); // end of dirEntry.getFile
			
			}); // fileSystem.root.getDirectory
			
		}); // end of window.requestFileSystem
		
	} //FUNCTION downloadJSONmulti
	
	</script>
	
	<h3 class="titoloDownloadFunzionalita"></h3>
	
	<ul class="downloadList">
	</ul>
	
	<p class="downloadComplete"><img src="img/download.gif"></p>
	
	</div>
	<!-- CONTENT -->

	<!-- FOOTER -->
	<div data-role="footer" data-position="fixed" data-tap-toggle="false">
		<h4></h4>
	</div>
	<!-- /FOOTER -->

</div>
<!-- /PAGE #setupCategorie -->

<!-- PAGE #setupNegozi -->
	<div data-role="page" id="setupNegozi">

	<!-- /HEADER -->
	<div data-role="header" data-position="fixed" data-tap-toggle="false">
		<h1></h1>
	</div>
	<!-- /HEADER -->
	
	<!-- CONTENT -->
	<div role="main" class="ui-content" >
	
	<script>   
	$( "#setupNegozi" ).on( "pageshow", function() {	
	
	document.addEventListener("backbutton", onBackKeyDown, false);
		
	function onBackKeyDown(e) {
	e.preventDefault();
	}
	
	$("h3.titoloDownloadEsercizi").html(window.localStorage.getItem("downloadEsercizi"));
	
	$.ajax({
		url: "http://www.wificomo.com/ccn20/JSONidEsercizi.php?start=0&end=2000",
		dataType: 'json',
		success: function(data) {
		
		var totaleEsercizi = data.length;
		
		var numeroBlocchiDownload = Math.floor(totaleEsercizi/50);
		var widthBlocchiDownload = 100/numeroBlocchiDownload;
		for (i=1; i<=numeroBlocchiDownload; i++) {
		$("div.progressBar").append("<div class='"+i+"' style='width:"+widthBlocchiDownload.toFixed(2)+"%; height:40px; float:left'></div>");
		}
		
		window.sessionStorage.setItem("totaleEsercizi", totaleEsercizi);
		window.sessionStorage.setItem("start", 0);
		window.sessionStorage.setItem("iteration", 1);
		
		downloadVetrineInterval();
		}
	});
	
	}); // ON "pageshow"
	
	
	function downloadVetrineInterval() {
	
	var start = window.sessionStorage.getItem('start');
	
	$.ajax({	
		url: "http://www.wificomo.com/ccn20/JSONidEsercizi.php?start="+start+"&end=50",
		dataType: 'json',
		success: function(data) {
		
		var codLingua = window.localStorage.getItem('codLingua');
		
			$.each(data, function(index, info) {
		
			var urlEsercizi = encodeURI("http://www.wificomo.com/ccn20/JSONvetrinaEsercizio.php?language="+codLingua+"&idEsercizio="+info.idEsercizio+"");	
			var fileNameEsercizi = info.idEsercizio+".js";	
			var directoryEsercizi = "ccn/esercizi";
		
			downloadVetrine(directoryEsercizi, fileNameEsercizi, urlEsercizi);
			});
		}
	});
	
	}//FUNCTION
	
	
	//DOWNLOAD JSONmulti FUNCTION
	function downloadVetrine(directory, fileName, fileURL, start, totaleEsercizi) {

		var fileTransfer = new FileTransfer();
		
		window.requestFileSystem(LocalFileSystem.PERSISTENT, 0, function(fileSystem) {
			
			fileSystem.root.getDirectory(directory, {create: true, exclusive: false}, function(dirEntry) {
			
				dirEntry.getFile(fileName, {create: true, exclusive: false}, function(fileEntry) {
										
					var localPath = fileEntry.fullPath;

					if (device.platform === "Android" && localPath.indexOf("file://") === 0) {
							localPath = localPath.substring(7);
					}
					
					fileTransfer.download(
						fileURL,
						localPath,
						function(entry) {
						
						var count = window.sessionStorage.getItem("start");
						var iteration = window.sessionStorage.getItem("iteration");
						
						count = parseInt(count)+1;
						window.sessionStorage.setItem("start", count);
													
							if(count == window.sessionStorage.getItem("totaleEsercizi")) {
							
							$("li.downloadVetrine").html("download vetrine <img src='img/downloadok.png'>");
							$("li.downloadVetrine").css("color","#00CC00");	
							$("div.progressBar").css("background","#00CC00");
							$("p.downloadCompleteVetrina").html("<a href='#facebook' class='ui-btn' data-transition='slide'>"+window.localStorage.getItem("continua")+"</a>");
							}
							else if(count == parseInt(iteration)*50) {
							
							$("div."+iteration+"").css("background","#00CC00");	
							iteration = parseInt(iteration)+1;
							window.sessionStorage.setItem("iteration", iteration);
							
							downloadVetrineInterval();
							}
						},
						function(error) {
													
							var countError = window.sessionStorage.getItem("start");
							var iterationError = window.sessionStorage.getItem("iteration");
						
							countError = parseInt(countError)+1;
							window.sessionStorage.setItem("start", countError);
													
							if(countError == window.sessionStorage.getItem("totaleEsercizi")) {
							
							$("li.downloadVetrine").html("download vetrine <img src='img/downloadok.png'>");
							$("li.downloadVetrine").css("color","#00CC00");	
							$("div.progressBar").css("background","#00CC00");
							$("p.downloadCompleteVetrina").html("<a href='#facebook' class='ui-btn' data-transition='slide'>"+window.localStorage.getItem("continua")+"</a>");
							}
							else if(countError == parseInt(iterationError)*50) {
							
							$("div."+iterationError+"").css("background","#00CC00");	
							iterationError = parseInt(iterationError)+1;
							window.sessionStorage.setItem("iteration", iterationError);
							
							downloadVetrineInterval();
							}
						},
						false,
						{
							headers: {
								"Authorization": "Basic dGVzdHVzZXJuYW1lOnRlc3RwYXNzd29yZA=="
							}
						}
				
					); // end of fileTransfer.download
				}); // end of dirEntry.getFile
			
			}); // fileSystem.root.getDirectory
			
		}); // end of window.requestFileSystem
		
	} //FUNCTION downloadJSONmulti
	
	</script>
	
	<h3 class="titoloDownloadEsercizi"></h3>
	
	<div class="progressBar" style="width: 100%; height: 40px; background:#C0C0C0">
	</div>
		
	<!--
	<ul style="list-style-type: none">
	<li class="downloadVetrine">download vetrine...<img src="img/download.gif"></li>
	</ul>
	-->
	
	<p class="downloadCompleteVetrina"><img src="img/download.gif"></p>
	
	</div>
	<!-- CONTENT -->

	<!-- FOOTER -->
	<div data-role="footer" data-position="fixed" data-tap-toggle="false">
		<h4></h4>
	</div>
	<!-- /FOOTER -->

</div>
<!-- /PAGE #setupNegozi -->

<!-- PAGE #facebook -->
	<div data-role="page" id="facebook">

	<!-- /HEADER -->
	<div data-role="header" data-position="fixed" data-tap-toggle="false">
		<h1></h1>
	</div>
	<!-- /HEADER -->
	
	<!-- CONTENT -->
	<div role="main" class="ui-content" >
	
	<div id="fb-root"></div>
	
	<script>
  
	$( "#facebook" ).on( "pagebeforeshow", function() {	
	
	document.addEventListener("backbutton", onBackKeyDown, false);
		
	function onBackKeyDown(e) {
	e.preventDefault();
	}
	
	var	connectionStatus = navigator.onLine ? 'online' : 'offline';
	if (connectionStatus == "offline")
	{
	$.mobile.changePage( "#index", { allowSamePageTransition:true } );
	}
	
	$("h3.titoloCollegaFacebook").html(window.localStorage.getItem("collegaSetupTitolo")+" Facebook");
	$("p.descrizioneCollegaFacebook").html(window.localStorage.getItem("collegaSetupDescrizione"));
	
	$("h2#h2skipFacebook").html(""+window.localStorage.getItem("noCollegaSocial")+"");
	$("p#pskipFacebook").html(""+window.localStorage.getItem("continua")+"");
	
	FB.init({ appId: "1448410138727682", nativeInterface: CDV.FB, useCachedDialogs: false });
	
	//GET LOGIN STATUS
	FB.getLoginStatus(function(response) {
	
		//CONNESSO
		if (response.status === 'connected') {
		
			FB.api('/me', function(response) {
			$("h2#h2loginFacebook").html(""+window.localStorage.getItem("accountCollegato")+"");
			$("p#ploginFacebook").html(""+response.name+"");
			$("h2#h2skipFacebook").html(""+window.localStorage.getItem("prossimoPasso")+"");
			$("p#pskipFacebook").html(""+window.localStorage.getItem("continua")+"");
			});
		}
		//APP NON AUTORIZZATA
		else if (response.status === 'not_authorized') {
		$("h2#h2loginFacebook").html("Login Facebook");
		$("p#ploginFacebook").html(""+window.localStorage.getItem("collegaSocial")+"");
		} 
		//NON CONNESSO
		else {
		$("h2#h2loginFacebook").html("Login Facebook");
		$("p#ploginFacebook").html(""+window.localStorage.getItem("collegaSocial")+"");
		}
		
	}, true);
	
	}); //ON "pageshow"
	
	$(document).on("click", 'a.facebook', function(){
	
	FB.login(function(response) {
            
		if (response.authResponse) {
			
			FB.api('/me', function(response) {
			$("h2#h2loginFacebook").html(""+window.localStorage.getItem("accountCollegato")+"");
			$("p#ploginFacebook").html(""+response.name+"");
			$("a.facebook").attr('href', '#foursquare');
			$("a.facebook").removeClass('facebook');
			$("h2#h2skipFacebook").html(""+window.localStorage.getItem("prossimoPasso")+"");
			$("p#pskipFacebook").html(""+window.localStorage.getItem("continua")+"");
			});
		}
		else {
            alert('not logged in');
        }
    },
	{ scope: "email" }
    );
	
	}); //ON "click"
	
</script>
	
	<h3 class="titoloCollegaFacebook"></h3>
	<p class="descrizioneCollegaFacebook"></p>
	
	<ul data-role="listview" data-inset="true">
		<li><a href="#" class="facebook" data-transition="slide">
			<img src="img/collegaFacebook.png">
			<h2 id="h2loginFacebook"></h2>
			<p id="ploginFacebook"></p></a>
		</li>
		<li><a href="#foursquare" id="saltaAFoursquare" data-transition="slide">
			<img src="img/skip.png">
			<h2 id="h2skipFacebook"></h2>
			<p id="pskipFacebook"></p></a>
		</li>
	</ul>
	
	</div>
	<!-- CONTENT -->

	<!-- FOOTER -->
	<div data-role="footer" data-position="fixed" data-tap-toggle="false">
		<h4></h4>
	</div>
	<!-- /FOOTER -->

	</div>
<!-- /PAGE #facebook -->

<!-- PAGE #foursquare -->
	<div data-role="page" id="foursquare">

	<!-- /HEADER -->
	<div data-role="header" data-position="fixed" data-tap-toggle="false">
		<h1></h1>
	</div>
	<!-- /HEADER -->
	
	<!-- CONTENT -->
	<div role="main" class="ui-content" >
	
	<script>   
	$( "#foursquare" ).on( "pagebeforeshow", function() {	
	
	document.addEventListener("backbutton", onBackKeyDown, false);
		
	function onBackKeyDown(e) {
	e.preventDefault();
	}
	
	var	connectionStatus = navigator.onLine ? 'online' : 'offline';
	if (connectionStatus == "offline")
	{
	$.mobile.changePage( "#index", { allowSamePageTransition:true } );
	}
	
	$("h3.titoloCollegaFoursquare").html(window.localStorage.getItem("collegaSetupTitolo")+" Foursquare");
	$("p.descrizioneCollegaFoursquare").html(window.localStorage.getItem("collegaSetupDescrizione"));
	
	$("h2#h2skipFoursquare").html(""+window.localStorage.getItem("noCollegaSocial")+"");
	$("p#pskipFoursquare").html(""+window.localStorage.getItem("continua")+"");
	
	var tokenFoursquare = window.localStorage.getItem("tokenFoursquare");
	
		if(tokenFoursquare == null) {
		$("h2#h2loginFoursquare").html("Login Foursquare");
		$("p#ploginFoursquare").html(""+window.localStorage.getItem("collegaSocial")+"");
		}
		else {
		$.getJSON('https://api.foursquare.com/v2/users/self?oauth_token='+tokenFoursquare+'&v=20140304', function(data){
		var user = data['response']['user']['firstName'];
		
		$("h2#h2loginFoursquare").html(""+window.localStorage.getItem("accountCollegato")+"");
		$("p#ploginFoursquare").html(""+user+"");
		$("a.foursquare").setAttribute("href", "#twitter");
		$("a.foursquare").removeClass('foursquare');
		$("h2#h2skipFoursquare").html("Avanti");
		$("p#pskipFoursquare").html(""+window.localStorage.getItem("continua")+"");
		});
		
		}
	
	}); //ON "pagebeforeshow"
	
	$(document).on("click", 'a.foursquare', function(){
	
	var ref = window.open('https://foursquare.com/oauth2/authenticate?client_id=4P4XY5XMV2EEGL4THQFXJFMJBTJN4WBNX1VIQGAUWDPHYZZF&response_type=token&redirect_uri=http://www.wificomo.com/ccn20/closeFoursquare.html', '_blank', 'location=no');
	
	ref.addEventListener('loadstart', function(event) {
    closeFoursquare(event.url,ref);
	}); 
	
	function closeFoursquare(loc,ref) {
   
		if (loc.indexOf("www.wificomo.com/ccn20/closeFoursquare.html#") > -1){
		var tokenFoursquare = loc.substring(loc.indexOf("=")+1);
		window.localStorage.setItem("tokenFoursquare", tokenFoursquare);
		
		$.getJSON('https://api.foursquare.com/v2/users/self?oauth_token='+tokenFoursquare+'&v=20140304', function(data){
		var user = data['response']['user']['firstName'];
		$("h2#h2loginFoursquare").html(""+window.localStorage.getItem("accountCollegato")+"");
		$("p#ploginFoursquare").html(""+user+"");
		$("a.foursquare").setAttribute("href", "#twitter");
		$("a.foursquare").removeClass('foursquare');
		$("h2#h2skipFoursquare").html(""+window.localStorage.getItem("prossimoPasso")+"");
		$("p#pskipFoursquare").html(""+window.localStorage.getItem("continua")+"");
		});
		
		ref.close();
		}
	}
	
	
	}); //ON "click"
		
	</script>
	
	<h3 class="titoloCollegaFoursquare"></h3>
	<p class="descrizioneCollegaFoursquare"></p>
	
	<ul data-role="listview" data-inset="true">
		<li><a href="#" class="foursquare" data-transition="slide">
			<img src="img/collegaFoursquare.png">
			<h2 id="h2loginFoursquare"></h2>
			<p id="ploginFoursquare"></p></a>
		</li>
		<li><a href="#twitter" data-transition="slide">
			<img src="img/skip.png">
			<h2 id="h2skipFoursquare"></h2>
			<p id="pskipFoursquare"></p></a>
		</li>
	</ul>
	
	</div>
	<!-- CONTENT -->

	<!-- FOOTER -->
	<div data-role="footer" data-position="fixed" data-tap-toggle="false">
		<h4></h4>
	</div>
	<!-- /FOOTER -->

	</div>
<!-- /PAGE #foursquare -->

<!-- PAGE #twitter -->
	<div data-role="page" id="twitter">

	<!-- /HEADER -->
	<div data-role="header" data-position="fixed" data-tap-toggle="false">
		<h1></h1>
	</div>
	<!-- /HEADER -->
	
	<!-- CONTENT -->
	<div role="main" class="ui-content" >
	
	<script>   
	$( "#twitter" ).on( "pagebeforeshow", function() {	
	
	document.addEventListener("backbutton", onBackKeyDown, false);
		
	function onBackKeyDown(e) {
	e.preventDefault();
	}
	
	var	connectionStatus = navigator.onLine ? 'online' : 'offline';
	if (connectionStatus == "offline")
	{
	$.mobile.changePage( "#index", { allowSamePageTransition:true } );
	}
	
	$("h3.titoloCollegaTwitter").html(window.localStorage.getItem("collegaSetupTitolo")+" Twitter");
	$("p.descrizioneCollegaTwitter").html(window.localStorage.getItem("collegaSetupDescrizione"));
	
	$("h2#h2skipTwitter").html(""+window.localStorage.getItem("noCollegaSocial")+"");
	$("p#pskipTwitter").html(""+window.localStorage.getItem("continua")+"");
	
	var twitterToken = window.localStorage.getItem("twitterToken");
	
		if(twitterToken == null) {
		$("h2#h2loginTwitter").html("Login Twitter");
		$("p#ploginTwitter").html(""+window.localStorage.getItem("collegaSocial")+"");
		}
		else {
		
		var twitterName = window.localStorage.getItem("twitterName");
		
		$("h2#h2loginTwitter").html(""+window.localStorage.getItem("accountCollegato")+"");
		$("p#ploginFoursquare").html(""+twitterName+"");
		$("a.twitter").setAttribute("href", "#index");
		$("a.twitter").removeClass('twitter');
		$("h2#h2skipTwitter").html(""+window.localStorage.getItem("prossimoPasso")+"");
		$("p#pskipTwitter").html(""+window.localStorage.getItem("continua")+"");
		}
	
	}); //ON "pagebeforeshow"
	
	
	$(document).on("click", 'a.twitter', function(){
	
	var ref = window.open('http://www.wificomo.com/twitter/twitterConnect.php', '_blank', 'location=no');
		
		ref.addEventListener('loadstart', function(event) {
        closeTwitter(event.url,ref);
		});  
	
	function closeTwitter(loc,ref) {
   
		if (loc.indexOf("www.wificomo.com/twitter/twitterTokens.php?") > -1){
		
		var twitterToken = loc.substring(loc.indexOf("oauth_token=")+12, loc.indexOf("&"));
		var twitterVerifier = loc.substring(loc.indexOf("oauth_verifier=")+15, loc.indexOf("&t"));
		var twitterName = loc.substring(loc.indexOf("twitterName=")+12);
		twitterName = decodeURIComponent(twitterName);
		
		window.localStorage.setItem("twitterToken", twitterToken);
		window.localStorage.setItem("twitterVerifier", twitterVerifier);
		window.localStorage.setItem("twitterName", twitterName);
		
		$("h2#h2loginTwitter").html(""+window.localStorage.getItem("accountCollegato")+"");
		$("p#ploginFoursquare").html(""+twitterName+"");
		$("a.twitter").setAttribute("href", "#index");
		$("a.twitter").removeClass('twitter');
		$("h2#h2skipTwitter").html(""+window.localStorage.getItem("prossimoPasso")+"");
		$("p#pskipTwitter").html(""+window.localStorage.getItem("continua")+"");
		
		ref.close();
		}
	}
	
	}); //ON "click"
	
	</script>
	
	<h3 class="titoloCollegaTwitter"></h3>
	<p class="descrizioneCollegaTwitter"></p>
	
	<ul data-role="listview" data-inset="true">
		<li><a href="#" class="twitter">
			<img src="img/collegaTwitter.png">
			<h2 id="h2loginTwitter"></h2>
			<p id="ploginTwitter"></p></a>
		</li>
		<li><a href="#index" id="saltaAIndex" data-transition="slide">
			<img src="img/skip.png">
			<h2 id="h2skipTwitter"></h2>
			<p id="pskipTwitter"></p></a>
		</li>
	</ul>
	
	</div>
	<!-- CONTENT -->

	<!-- FOOTER -->
	<div data-role="footer" data-position="fixed" data-tap-toggle="false">
		<h4></h4>
	</div>
	<!-- /FOOTER -->

	</div>
<!-- /PAGE #twitter -->

<!-- Start of page: #vetrinaMappa -->
<div data-role="page" id="vetrinaMappa">

	<div data-role="header" data-position="fixed" data-tap-toggle="false">
		<h1></h1>
		<a href="#index" class="ui-btn ui-icon-carat-l ui-btn-icon-notext ui-alt-icon ui-nodisc-icon" data-transition="slide" data-direction="reverse">indietro</a>
	</div><!-- /header -->

	<div role="main" class="ui-content" >
		
	
	<script type="text/javascript" charset="utf-8">
	

	$( document ).on( "pageshow", "#vetrinaMappa", function() {
	
	document.addEventListener("backbutton", onBackKeyDown, false);
		
		function onBackKeyDown(e) {
		e.preventDefault();
		}
	
// CARICA FILE VETRINA
	
		var path = window.localStorage.getItem("pathSD");
		var jsonPath = path + "/esercizi/"+idEsercizio+".js";
		var jsonVetrina;
		
		$.ajax({
			url: jsonPath,
			dataType: 'json',
			async: false,
			success: function(data) {
			jsonVetrina = data;
			sessionStorage.setItem('jsonVetrina', JSON.stringify(jsonVetrina));
			}
		}); // AJAX END
	
// NOME ESERCIZIO + INDIRIZZO + DESCRIZIONE
	
		var esercizioLatitude;
		var esercizioLongitude;
		var nomeEsercizioMappa;
		var descrizioneEsercizio;
		var linguaDescrizioneEsercizio;
		var parcheggioVicino;
		var map;
	
		$.each(jsonVetrina, function(index, info) {
				$("h3.nomeEsercizio").html(info.NomeEsercizio);
				$(".indirizzoEsercizio").html(info.Indirizzo+" "+info.Citta);
				$(".descrizioneEsercizio").html(""); // SVUOTA DESCRIZIONE PER PREVENIRE DESCRIZIONI NULLE
				$(".descrizioneEsercizio").html(info.Descrizione);
				 
				esercizioLatitude = info.Latitudine;
				esercizioLongitude = info.Longitudine;
				nomeEsercizioMappa = info.NomeEsercizio;
				descrizioneEsercizio = info.Descrizione;
				linguaDescrizioneEsercizio = info.LinguaDescrizione;
				if (info.Parcheggio != undefined)
				{
				parcheggioVicino = info.Parcheggio.nomeParcheggio+" "+info.Parcheggio.indirizzoParcheggio;
				}
		});
		
//NAVIGATE BUTTON
		
		$( ".navigateEsercizio" ).html("");
		$( ".navigateEsercizio" ).append("<a href='#' geoPosition='"+esercizioLatitude+","+esercizioLongitude+"'class='directions'><img src='img/navigation.png'>portami qui</a>");

// DESCRIZIONE + TRANSLATE BUTTON
		var codLingua = localStorage.getItem("codLingua");
		if(!(codLingua == 'it' || codLingua == 'en')){
			if(descrizioneEsercizio != undefined)
			{
			$( "#box-descrizioneEsercizio" ).show();
			$( ".traduciDescrizioneEsercizio" ).html("");
			$( ".traduciDescrizioneEsercizio" ).html( "<button class='translate' codLingua='"+codLingua+"' linguaDescrizione='"+linguaDescrizioneEsercizio+"'>Traduci</button>" );	
			}
			else{
			$( "#box-descrizioneEsercizio" ).hide();
			}
		}


// PARCHEGGIO VICINO
		
		if (parcheggioVicino == undefined){
		$( ".parcheggioVicino" ).html("");
		}
		else{
		$( ".parcheggioVicino" ).html("");
		$( ".parcheggioVicino" ).append( "<li class='immagineParcheggio'><img class='imgParcheggio' src='img/parcheggioVicino.png' style='width: 37px; height: 50px;'><p class='nomeParcheggio'>"+parcheggioVicino+"</p></li>" );
		}
		
		
// MAPPA + POSIZIONE UTENTE
	
		//INIZIALIZZAZIONE MAPPA
		
		$( "#map" ).remove();
		var $map = $("<div>", {id: "map", class: "a", style:"width: 1920px; height:400px"});
		$("#mappa").append($map);
		
		map = new L.Map('map');
	
		var osmUrl='http://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png';
		L.tileLayer(osmUrl, {minZoom: 13, maxZoom: 18}).addTo(map);
		
		/*
		L.tileLayer('img/como/{z}/{x}/{y}.png', {
		maxZoom: 18
		}).addTo(map);
		*/
		
		map.setView(new L.LatLng(45.80806, 9.08518),14); //MAPPA SU COMO
		
		//BOTTONI CONTROLLO ZOOM
		var controlloZoom = L.control({ position: 'bottomleft' });
		controlloZoom.onAdd = function (map) {
			this._div = L.DomUtil.create('div', 'controlloZoom');
			this._div.innerHTML = '<button class="groupMarker"><img src="img/userShop.png"></button><button class="userMarker"><img src="img/userPosition.png"></button>';
			return this._div;
		};
		controlloZoom.addTo(map);
		
		
		var userLatitude;
		var userLongitude;
		var markerUtente;
		var markerEsercizio;
		var group;
		var watchID = null;
		var options = { maximumAge: 1500, timeout: 30000, enableHighAccuracy: true };
      		
		var markerIcon = L.icon({
			iconUrl: 'img/marker-icon.png',
			iconSize:     [25, 41], // size of the icon
			popupAnchor:  [0, -20] // point from which the popup should open relative to the iconAnchor
		});
		
		markerEsercizio = L.marker([esercizioLatitude, esercizioLongitude], {icon: markerIcon}).addTo(map).bindPopup(nomeEsercizioMappa);
		
		$(".distanzaEsercizio").html("");
		
		watchID = navigator.geolocation.watchPosition(onSuccess, onErrorPosition, options);
		
// FUNCTION SUCCESS WATCH POSITION

		function onSuccess(position) {
	 		
			userLatitude = position.coords.latitude;
			userLongitude = position.coords.longitude;
	
			var distance = 5000;
			var jsonPositionDir = path + "/position.js";
			$.getJSON(jsonPositionDir, function( jsonPosition ) {
				$.each(jsonPosition, function(index, info) {
					currentDistance = getDistanceFromLatLonInKm(userLatitude,userLongitude,info.latEsercizio,info.lonEsercizio);
					if(distance > currentDistance && info.idEsercizio != idEsercizio)
					{
						distance = currentDistance;
						nearestEsercizio = info.idEsercizio;
					}
				});
				console.log("Nodo vicino: "+nearestEsercizio);
				console.log(distance);
				if(distance < 500)
				{				
					var jsonVetrinaSession = JSON.parse(window.sessionStorage.getItem("jsonVetrina"));
					var obj = jsonVetrinaSession[0];
						if(nearestEsercizio in obj.Distanze){
						
								$.each(obj.Distanze, function(index, infoDistance) {
									if(infoDistance.idEsercizio == nearestEsercizio){
										var minutes = Math.floor(infoDistance.time / 60);
										var seconds = infoDistance.time - minutes * 60;
										$(".distanzaEsercizio").html(infoDistance.distance+"m - "+minutes+":"+seconds+" min<p class='esercizioVicino'>Ora sei vicino a "+infoDistance.nomeEsercizio+"</p>");
									}
								});
						}
						else{
						$(".distanzaEsercizio").html("+200m");
						}
				}
				else
				{
				$(".distanzaEsercizio").html("Troppo lontato per calcolare");
				}
			
			}); //END GET JSON POSITION 
	
			var userAccuracy = position.coords.accuracy 

			if (!markerUtente) {
			markerUtente = L.userMarker([userLatitude, userLongitude],{pulsing:true}).bindPopup("Sei qui.").addTo(map);
			markerUtente.setAccuracy(userAccuracy);
			map.setView(new L.LatLng(userLatitude, userLongitude),16);
			}
			markerUtente.setLatLng([userLatitude, userLongitude],{pulsing:true}).update();
	
		} // END ON SUCCESS
	
		function onErrorPosition(error) {
			//alert('code: '    + error.code    + '\n' + 'message: ' + error.message + '\n');
		}

// CLICK ZOOM BUTTONS
	
		$(document).on("click", 'button.groupMarker', function(){
			group = new L.featureGroup([markerEsercizio, markerUtente]);
			map.fitBounds(group.getBounds().pad(0.25));
		});
		
		$(document).on("click", 'button.userMarker', function(){
			map.setView(new L.LatLng(userLatitude, userLongitude),16);
		});
	
	});
	// END OF PAGESHOW

// CLICK DIRECTIONS GOOGLE
	$(document).on("click", 'a.directions', function(){
		geoPosition = $(this).attr('geoPosition');
		directions(geoPosition);
	});
	
// CLICK TRANSLATE GOOGLE
	$(document).on("click", '.translate', function(){
		var descrizioneTranslate = $(".descrizioneEsercizio").text();
		var linguaDescrizione = $(this).attr('linguaDescrizione');
		var codLingua = $(this).attr('codLingua');
		var urlTranslate = encodeURI("http://translate.google.com/#"+linguaDescrizione+"/"+codLingua+"/"+descrizioneTranslate+"");
		var ref = window.open(urlTranslate, '_blank', 'location=yes');
		//ref.addEventListener('loadstart', function() { alert(event.url); });
	});
	
// FUNZIONE DISTANZA NEAREST NODE
	
	function getDistanceFromLatLonInKm(lat1,lon1,lat2,lon2) {
  
		var R = 6371; // Radius of the earth in km
  
		var dLat = deg2rad(lat2-lat1);  // deg2rad below
		var dLon = deg2rad(lon2-lon1); 
  
		var a = 
		Math.sin(dLat/2) * Math.sin(dLat/2) +
		Math.cos(deg2rad(lat1)) * Math.cos(deg2rad(lat2)) * 
		Math.sin(dLon/2) * Math.sin(dLon/2)
		; 
  
		var c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a)); 
		var d = R * c * 1000; // Distance in km
		return Math.round(d);
	}

	function deg2rad(deg) {
		return deg * (Math.PI/180)
	}
		
// FUNZIONE DIRECTIONS GOOGLE
	
	function directions(geoPosition) {
		navigator.google_navigate.navigate(geoPosition, function() {
			console.log('Success');
		}, function(errMsg) {
			console.log("Failed: " + errMsg);
		});
	}
	
	// /FUNZIONE DIRECTIONS
		
	</script>
	
	<!-- NOME ESERCIZIO -->
	
	<div id="box-nomeEsercizio">
	<h3 class="nomeEsercizio"></h3>
	</div>
	
	<!-- /NOME ESERCIZIO -->
	
	<!-- MAPPA + INDIRIZZO + DIRECTIONS + PANORAMICA + DISTANZA -->
	<div id="mappa"></div>
	<ul class="funzionalitaMappa">
	<li class="singolaFunzionalitaMappa indirizzoEsercizio"></li>
	<li class="singolaFunzionalitaMappa navigateEsercizio"></li>
	<li class="singolaFunzionalitaMappa distanzaEsercizio"></li>
	</ul>
	<!-- /MAPPA + INDIRIZZO + DIRECTIONS + PANORAMICA + DISTANZA -->
	
	<!-- DESCRIZIONE ESERCIZIO -->
	
	<div id="box-descrizioneEsercizio">
	<p class="descrizioneEsercizio"></p>
	<p class="traduciDescrizioneEsercizio"></p>
	</div>
	<!-- /DESCRIZIONE ESERCIZIO -->
	
	<!-- PARCHEGGIO VICINO ESERCIZIO -->
	
	<ul class="parcheggioVicino">
	</ul>
	<!-- /PARCHEGGIO VICINO ESERCIZIO -->
		
	</div><!-- /content -->

	<!-- FOOTER -->
	<div data-role="footer" data-position="fixed" data-tap-toggle="false">
		<!-- NAVBAR -->
		<div data-role="navbar">
            <ul>
                <li><a href="#" class="ui-btn-active ui-state-persist"><img src="img/vetrina.png"></a></li>
                <li><a href="#vetrinaOrari" data-transition="slide"><img src="img/orari.png"></a></li>
                <li><a href="#vetrinaContatti" data-transition="slide"><img src="img/contatti.png"></a></li>
				<li><a href="#vetrinaStatistiche" data-transition="slide"><img src="img/statistiche.png"></a></li>
            </ul>
        </div>
		<!-- /NAVBAR -->
	</div>
	<!-- /FOOTER -->
	
</div><!-- /page vetrinaMappa -->

<!-- Start of page: #vetrinaOrari -->
<div data-role="page" id="vetrinaOrari">

	<div data-role="header" data-position="fixed" data-tap-toggle="false">
		<h1></h1>
		<a href="#index" class="ui-btn ui-icon-carat-l ui-btn-icon-notext ui-alt-icon ui-nodisc-icon" data-transition="slide" data-direction="reverse">indietro</a>
	</div><!-- /header -->

	<div role="main" class="ui-content" >
		
	
	<script type="text/javascript" charset="utf-8">
	
	$( document ).on( "pagebeforeshow", "#vetrinaOrari", function() {
	
	document.addEventListener("backbutton", onBackKeyDown, false);
		
		function onBackKeyDown(e) {
		e.preventDefault();
		}
	
	var jsonVetrina = window.sessionStorage.getItem("jsonVetrina");
	
	// NOME ESERCIZIO + ORARI ESERCIZIO
	
	$("ul#orariEsercizio").html("");
	
	$.each(JSON.parse(jsonVetrina), function(index, info) {
				
		$("h3.nomeEsercizio").html(info.NomeEsercizio);
		$("ul#orariEsercizio").append($("<li data-role='list-divider'>Orari di Apertura</li>"));
		$("ul#orariEsercizio").append($("<li>Lunedi: "+info.Orario.lunedi+"</li>"));
		$("ul#orariEsercizio").append($("<li>Martedi: "+info.Orario.martedi+"</li>"));
		$("ul#orariEsercizio").append($("<li>Mercoledi: "+info.Orario.mercoledi+"</li>"));
		$("ul#orariEsercizio").append($("<li>Giovedi: "+info.Orario.giovedi+"</li>"));
		$("ul#orariEsercizio").append($("<li>Venerdi: "+info.Orario.venerdi+"</li>"));
		$("ul#orariEsercizio").append($("<li>Sabato: "+info.Orario.sabato+"</li>"));
		$("ul#orariEsercizio").append($("<li>Domenica: "+info.Orario.domenica+"</li>"));
		$("ul#orariEsercizio").listview("refresh");
							
	});
		
		
	// /NOME ESERCIZIO + ORARI ESERCIZIO
	
	});
	// /PAGEBEFORESHOW
	
	
	</script>
	
	<!-- NOME ESERCIZIO -->
	
	<div id="box-nomeEsercizio">
	<h3 class="nomeEsercizio"></h3>
	</div>
	
	<!-- /NOME ESERCIZIO -->
	
	<!-- ORARI -->
	<ul id="orariEsercizio" data-role="listview" data-inset="true">
	</ul>
	<!-- /ORARI -->
			
	</div><!-- /content -->

	<!-- FOOTER -->
	<div data-role="footer" data-position="fixed" data-tap-toggle="false">
		<!-- NAVBAR -->
		<div data-role="navbar">
            <ul>
                <li><a href="#vetrinaMappa" data-transition="slide" data-direction="reverse"><img src="img/vetrina.png"></a></li>
                <li><a href="#" class="ui-btn-active ui-state-persist"><img src="img/orari.png"></a></li>
                <li><a href="#vetrinaContatti" data-transition="slide"><img src="img/contatti.png"></a></li>
				<li><a href="#vetrinaStatistiche" data-transition="slide"><img src="img/statistiche.png"></a></li>
				<!-- <li><a href="#" data-icon="camera">Gallery</a></li> -->
            </ul>
        </div>
		<!-- /NAVBAR -->
	</div>
	<!-- /FOOTER -->
	
</div><!-- /page vetrinaOrari -->

<!-- Start of page: #vetrinaContatti -->
<div data-role="page" id="vetrinaContatti">

	<div data-role="header" data-position="fixed" data-tap-toggle="false">
		<h1></h1>
		<a href="#index" class="ui-btn ui-icon-carat-l ui-btn-icon-notext ui-alt-icon ui-nodisc-icon" data-transition="slide" data-direction="reverse">indietro</a>
	</div><!-- /header -->

	<div role="main" class="ui-content" >
		
	
	<script type="text/javascript" charset="utf-8">
	
	$( document ).on( "pagebeforeshow", "#vetrinaContatti", function() {
	
	document.addEventListener("backbutton", onBackKeyDown, false);
		
		function onBackKeyDown(e) {
		e.preventDefault();
		}
	
	var jsonVetrina = window.sessionStorage.getItem("jsonVetrina");
	
	// NOME ESERCIZIO + CONTATTI ESERCIZIO
	
	$("ul#contattiEsercizio").html("");
	
	$.each(JSON.parse(jsonVetrina), function(index, info) {
				
		$("h3.nomeEsercizio").html(info.NomeEsercizio);
		$("ul#contattiEsercizio").append($("<li data-role='list-divider'>Contatti</li>"));
		$("ul#contattiEsercizio").append($("<li>Indirizzo: "+info.Indirizzo+" "+info.Citta+"</li>"));
		if (info.Telefono != undefined){$("ul#contattiEsercizio").append($("<li><a href=tel:"+info.Telefono.replace(/ /g,'')+">Telefono: "+info.Telefono+"</a></li>"))};
		if (info.Website != undefined){$("ul#contattiEsercizio").append($("<li><a href="+info.Website+">Website: "+info.Website+"</a></li>"))};
		if (info.Email != undefined){$("ul#contattiEsercizio").append($("<li><a href=mailto:"+info.Email+">Email: "+info.Email+"</a></li>"))};
		if (info.Facebook != undefined){$("ul#contattiEsercizio").append($("<li>Facebook: "+info.Facebook+"</li>"))};
		if (info.Twitter != undefined){$("ul#contattiEsercizio").append($("<li>Twitter: "+info.Twitter+"</li>"))};
		if (info.Foursquare != undefined){$("ul#contattiEsercizio").append($("<li>Foursquare: "+info.Foursquare+"</li>"))};
		$("ul#contattiEsercizio").listview("refresh");
							
	});
		
		
	// /NOME ESERCIZIO + CONTATTI ESERCIZIO
	});
	// /PAGEBEFORESHOW
	
	
	
	</script>
	
	<!-- NOME ESERCIZIO -->
	
	<div id="box-nomeEsercizio">
	<h3 class="nomeEsercizio"></h3>
	</div>
	
	<!-- /NOME ESERCIZIO -->
	
	<!-- CONTATTI ESERCIZIO -->
	
	<ul id="contattiEsercizio" data-role="listview" data-inset="true">
	</ul>
	
	<!-- /CONTATTI ESERCIZIO -->
			
	</div><!-- /content -->

	<!-- FOOTER -->
	<div data-role="footer" data-position="fixed" data-tap-toggle="false">
		<!-- NAVBAR -->
		<div data-role="navbar">
            <ul>
                <li><a href="#vetrinaMappa" data-transition="slide" data-direction="reverse"><img src="img/vetrina.png"></a></li>
                <li><a href="#vetrinaOrari" data-transition="slide" data-direction="reverse"><img src="img/orari.png"></a></li>
                <li><a href="#" class="ui-btn-active ui-state-persist"><img src="img/contatti.png"></a></li>
				<li><a href="#vetrinaStatistiche" data-transition="slide"><img src="img/statistiche.png"></a></li>
            </ul>
        </div>
		<!-- /NAVBAR -->
	</div>
	<!-- /FOOTER -->
	
</div><!-- /page vetrinaContatti -->

<!-- Start of page: #vetrinaStatistiche -->
<div data-role="page" id="vetrinaStatistiche">

	<div data-role="header" data-position="fixed" data-tap-toggle="false">
		<h1></h1>
		<a href="#index" class="ui-btn ui-icon-carat-l ui-btn-icon-notext ui-alt-icon ui-nodisc-icon" data-transition="slide" data-direction="reverse">indietro</a>
	</div><!-- /header -->

	<div role="main" class="ui-content" >
		
	
	<script type="text/javascript" charset="utf-8">
	
	$( document ).on( "pagebeforeshow", "#vetrinaStatistiche", function() {
	
	document.addEventListener("backbutton", onBackKeyDown, false);
		
		function onBackKeyDown(e) {
		e.preventDefault();
		}
	
	var jsonVetrina = window.sessionStorage.getItem("jsonVetrina");
	
	// NOME ESERCIZIO + STATISTICHE
	
	var checkStatistiche;
	var idEsercizio;
	
		$.each(JSON.parse(jsonVetrina), function(index, info) {
				
			$("h3.nomeEsercizio").html(info.NomeEsercizio);
			idEsercizio = info.idEsercizio;
			checkStatistiche = info.Statistiche;
			
			
		});
	
	if(checkStatistiche == "si"){
	
		//var checkConnection = checkConnection();
		//if (checkConnection =! "No_network")
		//{
			$(function () {
			var chart;
			var perShapeGradient = {
				x1: 0,
				y1: 0,
				x2: 1,
				y2: 0
			};

			$(document).ready(function() {
		
			$.getJSON("http://www.wificomo.com/ccn20/JSONbarchart.php", {idNegozio: idEsercizio}, function( json ) {
		
				jsonFilter = jQuery.grep(json, function (v) {
				return v.intervallo == "15giorni";
				console.log("filtro base: ");
				console.log(jsonFilter);
				});
		
				chart = new Highcharts.Chart({
					chart: {
						renderTo: 'barChart',
						type: 'column',
						marginRight: 10,
						marginBottom: 25
					},
					colors: [{
						linearGradient: perShapeGradient,
						stops: [
							[0, 'rgb(80, 135, 226)'],
							[1, 'rgb(25, 70, 148)']
							]
						}, {
						linearGradient: perShapeGradient,
						stops: [
							[0, 'rgb(120, 202, 248)'],
							[1, 'rgb(46, 150, 208)']
							]
						}, {
						linearGradient: perShapeGradient,
						stops: [
							[0, 'rgb(136, 219, 5)'],
							[1, 'rgb(112, 180, 5)']
							]}, 
					],
					title: {
						text: '',
						x: -20, //center
					},
					subtitle: {
						text: '',
						x: -20
					},
					xAxis: {
						startOnTick: false,
						endOnTick:false,
						type: 'datetime',
						tickInterval: 4 * 24 * 3600 * 1000,
						minTickInterval: 86400000,
						dateTimeLabelFormats: {
						day: '%e %m'
						},
						labels: {
						enabled: false
						}
					},
					yAxis: {
						allowDecimals: false,
						stackLabels: {
						enabled: true
						},
						title: {
						text: 'Voti'
						}
					},
					tooltip: {
						enabled: true,
						xDateFormat: '%d-%m-%Y'
					},
					plotOptions: {
						column: {
						stacking: 'normal',
						pointWidth:5,
						dataLabels: {
										enabled: false,
										color: (Highcharts.theme && Highcharts.theme.dataLabelsColor) || 'black'
									}
						}
					},
					legend: {
						layout: 'horizontal',
						align: 'center',
						verticalAlign: 'top',
						borderWidth: 0,
						enabled: true,
						floating: true
					},
					series: jsonFilter
				});

				
			$( "button#intervallo" ).click(function() {
			var intervallo = $(this).attr('value');
			jsonFilter = jQuery.grep(json, function (v) {
			return v.intervallo == intervallo;
			});
		
			chart = new Highcharts.Chart({
					chart: {
						renderTo: 'barChart',
						type: 'column',
						marginRight: 10,
						marginBottom: 25
					},
					colors: [{
						linearGradient: perShapeGradient,
						stops: [
							[0, 'rgb(80, 135, 226)'],
							[1, 'rgb(25, 70, 148)']
							]
						}, {
						linearGradient: perShapeGradient,
						stops: [
							[0, 'rgb(120, 202, 248)'],
							[1, 'rgb(46, 150, 208)']
							]
						}, {
						linearGradient: perShapeGradient,
						stops: [
							[0, 'rgb(136, 219, 5)'],
							[1, 'rgb(112, 180, 5)']
							]}, 
					],
					title: {
						text: '',
						x: -20, //center
					},
					subtitle: {
						text: '',
						x: -20
					},
					xAxis: {
						startOnTick: false,
						endOnTick:false,
						type: 'datetime',
						tickInterval: 4 * 24 * 3600 * 1000,
						minTickInterval: 86400000,
						dateTimeLabelFormats: {
						day: '%e %m'
						},
						labels: {
						enabled: false
						}
					},
					yAxis: {
						allowDecimals: false,
						stackLabels: {
						enabled: true
						},
						title: {
						text: 'Voti'
						}
					},
					tooltip: {
						enabled: true,
						xDateFormat: '%d-%m-%Y'
					},
					plotOptions: {
						column: {
						stacking: 'normal',
						pointWidth:5,
						dataLabels: {
										enabled: false,
										color: (Highcharts.theme && Highcharts.theme.dataLabelsColor) || 'black'
									}
						}
					},
					legend: {
						layout: 'horizontal',
						align: 'center',
						verticalAlign: 'top',
						borderWidth: 0,
						enabled: true,
						floating: true
					},
					series: jsonFilter
				});

		
		
			});
		
			});
			});
		
			});
		
		//}
		//else{
		//$("#checkStatistiche").html("Questa funzionalità è disponibile solo se collegati alla rete 3G o WiFi");
		//}
	
	}
	else{
	$("#checkStatistiche").html("Il negoziante non permette la visualizzazione pubblica delle statistiche");
	}
		
	// /NOME ESERCIZIO + STATISTICHE
	
	});
	// /PAGEBEFORESHOW

	</script>
	
	<!-- NOME ESERCIZIO -->
	
	<div id="box-nomeEsercizio">
	<h3 class="nomeEsercizio"></h3>
	</div>
	
	<!-- /NOME ESERCIZIO -->
	
	<!-- STATISTICHE -->
	<div id="box-statisticheEsercizio">
	<p id="checkStatistiche"></p>
	<div id="barChart" style="width: 1920px; height:450px"></div>
	<div>
	<button id="intervallo" value="7giorni">7 giorni</button>
	<button id="intervallo"value="15giorni">15 giorni</button>
	<button id="intervallo" value="30giorni">30 giorni</button>
	</div>
	</div>
	<!-- /STATISTICHE -->
	
		
	</div><!-- /content -->

	<!-- FOOTER -->
	<div data-role="footer" data-position="fixed" data-tap-toggle="false">
		<!-- NAVBAR -->
		<div data-role="navbar">
            <ul>
                <li><a href="#vetrinaMappa" data-transition="slide" data-direction="reverse"><img src="img/vetrina.png"></a></li>
                <li><a href="#vetrinaOrari" data-transition="slide" data-direction="reverse"><img src="img/orari.png"></a></li>
                <li><a href="#vetrinaContatti" data-transition="slide" data-direction="reverse"><img src="img/contatti.png"></a></li>
				<li><a href="#" class="ui-btn-active ui-state-persist"><img src="img/statistiche.png"></a></li>
            </ul>
        </div>
		<!-- /NAVBAR -->
	</div>
	<!-- /FOOTER -->
	
</div><!-- /page vetrinaStatistiche -->

<!-- PAGE #credits -->
<div data-role="page" id="credits">

	<!-- /HEADER -->
	<div data-role="header" data-position="fixed" data-tap-toggle="false">
		<h1></h1>
		<a href="#index" class="ui-btn ui-icon-carat-l ui-btn-icon-notext ui-alt-icon ui-nodisc-icon" data-transition="flip" data-direction="reverse">indietro</a>
	</div>
	<!-- /HEADER -->
	
	<!-- CONTENT -->
	<div role="main" class="ui-content" >
	
	<script>   
	$( "#credits" ).on( "pagebeforeshow", function() {	
	
	document.addEventListener("backbutton", function(e){
    
		navigator.app.backHistory()
		
	}, false);
	
	});
		
	</script>
	
	<p>CREDITS + LOGHI</p>

	</div>
	<!-- /CONTENT -->

	<!-- FOOTER -->
	<div data-role="footer" data-position="fixed" data-tap-toggle="false">
		<h4></h4>
	</div>
	<!-- /FOOTER -->
	
</div><!-- /PAGE #credits -->

</body>
</html>